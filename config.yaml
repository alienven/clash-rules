mixed-port: 7890 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£
# redir-port: 7892
# tproxy-port: 7893
log-level: warning # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug
allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®š IP åœ°å€ï¼Œä»…ä½œç”¨äº allow-lan ä¸º trueï¼Œ'*'è¡¨ç¤ºæ‰€æœ‰åœ°å€
mode: rule
ipv6: false
unified-delay: false # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿæ—¶ï¼Œä¼šè®¡ç®— RTTï¼Œä»¥æ¶ˆé™¤è¿æ¥æ¡æ‰‹ç­‰å¸¦æ¥çš„ä¸åŒç±»å‹èŠ‚ç‚¹çš„å»¶è¿Ÿå·®å¼‚
tcp-concurrent: true # TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± mihomo åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: off
profile:
  store-selected: true # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-fake-ip: true # æŒä¹…åŒ– fake-ip
global-client-fingerprint: chrome # "chrome","firefox","safari","ios","random","none" options.
global-ua: clash.meta
#  TCP keep alive interval
# disable-keep-alive: false #ç›®å‰åœ¨androidç«¯å¼ºåˆ¶ä¸ºtrue
# keep-alive-idle: 15
# keep-alive-interval: 15
#è‡ªå®šä¹‰ geodata url
geox-url:
  geoip: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
  mmdb: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb"
  asn: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb"
geodata-loader: standard #standardï¼šæ ‡å‡†åŠ è½½å™¨ memconservativeï¼šä¸“ä¸ºå†…å­˜å—é™ (å°å†…å­˜) è®¾å¤‡ä¼˜åŒ–çš„åŠ è½½å™¨ (é»˜è®¤å€¼)
geo-auto-update: true # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 72 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

# Tun é…ç½®
tun:
  enable: false
  stack: system # gvisor/mixed
  dns-hijack:
    - any:53

# å—…æ¢åŸŸå å¯é€‰é…ç½®redir-hostæ¨¡å¼å¼€å¯
sniffer:
  enable: true
  force-dns-mapping: true ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  parse-pure-ip: true ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  override-destination: true ## æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  sniff: # TLS å’Œ QUIC é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    QUIC:
    TLS:
    HTTP: # é»˜è®¤å—…æ¢ 80
  # force-domain:
  #   - +.v2ex.com
  # skip-src-address: # å¯¹äºæ¥æºipè·³è¿‡å—…æ¢
  #   - 192.168.0.0/16
  skip-dst-address: # å¯¹äºç›®æ ‡ipè·³è¿‡å—…æ¢
    - 192.168.0.0/16
  ## å¯¹å—…æ¢ç»“æœè¿›è¡Œè·³è¿‡
  skip-domain:
    - Mijia Cloud
    - dlg.io.mi.com
    - geosite:private

#hosts:
# '*.mihomo.dev': 127.0.0.1
# '.dev': 127.0.0.1
# 'alpha.mihomo.dev': '::1'
# test.com: [1.1.1.1, 2.2.2.2]
# home.lan: lan # lan ä¸ºç‰¹åˆ«å­—æ®µï¼Œå°†åŠ å…¥æœ¬åœ°æ‰€æœ‰ç½‘å¡çš„åœ°å€
# baidu.com: google.com # åªå…è®¸é…ç½®ä¸€ä¸ªåˆ«å

# DNS é…ç½®
dns:
  enable: true
  prefer-h3: false
  ipv6: false
  enhanced-mode: fake-ip # fake-ip or redir-host
  fake-ip-range: 198.18.0.1/16 # fake-ip æ± è®¾ç½®
  # é…ç½®fake-ip-filterçš„åŒ¹é…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºblacklistï¼Œå³å¦‚æœåŒ¹é…æˆåŠŸä¸è¿”å›fake-ip
  # å¯è®¾ç½®ä¸ºwhitelistï¼Œå³åªæœ‰åŒ¹é…æˆåŠŸæ‰è¿”å›fake-ip
  fake-ip-filter-mode: whitelist
  fake-ip-filter:
    # fakeip-filter ä¸º rule-providers ä¸­çš„åä¸º fakeip-filter è§„åˆ™è®¢é˜…ï¼Œ
    # ä¸” behavior å¿…é¡»ä¸º domain/classicalï¼Œå½“ä¸º classical æ—¶ä»…ä¼šç”Ÿæ•ˆåŸŸåç±»è§„åˆ™
    - rule-set:ProxyLite

  # use-hosts: true # æŸ¥è¯¢ hosts

  # é…ç½®åé¢çš„nameserverã€fallbackå’Œnameserver-policyå‘dnsæœåŠ¡å™¨çš„è¿æ¥è¿‡ç¨‹æ˜¯å¦éµå®ˆéµå®ˆrulesè§„åˆ™
  # å¦‚æœä¸ºfalseï¼ˆé»˜è®¤å€¼ï¼‰åˆ™è¿™ä¸‰éƒ¨åˆ†çš„dnsæœåŠ¡å™¨åœ¨æœªç‰¹åˆ«æŒ‡å®šçš„æƒ…å†µä¸‹ä¼šç›´è¿
  # å¦‚æœä¸ºtrueï¼Œå°†ä¼šæŒ‰ç…§rulesçš„è§„åˆ™åŒ¹é…é“¾æ¥æ–¹å¼ï¼ˆèµ°ä»£ç†æˆ–ç›´è¿ï¼‰ï¼Œå¦‚æœæœ‰ç‰¹åˆ«æŒ‡å®šåˆ™ä»»ç„¶ä»¥æŒ‡å®šå€¼ä¸ºå‡†
  # ä»…å½“proxy-server-nameserveréç©ºæ—¶å¯ä»¥å¼€å¯æ­¤é€‰é¡¹, å¼ºçƒˆä¸å»ºè®®å’Œprefer-h3ä¸€èµ·ä½¿ç”¨
  # æ­¤å¤–ï¼Œè¿™ä¸‰è€…é…ç½®ä¸­çš„dnsæœåŠ¡å™¨å¦‚æœå‡ºç°åŸŸåä¼šé‡‡ç”¨default-nameserveré…ç½®é¡¹è§£æï¼Œä¹Ÿè¯·ç¡®ä¿æ­£ç¡®é…ç½®default-nameserver
  respect-rules: false

  # ç”¨äºè§£æ DNS æœåŠ¡å™¨ çš„åŸŸå
  default-nameserver:
    - 127.0.0.1:6053
  # é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨
  nameserver:
    - 127.0.0.1:6053
  # ä»…ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸå
  proxy-server-nameserver:
    - 127.0.0.1:6053

# èŠ‚ç‚¹
proxies:
  - name: "US-Reality"
    type: vless
    server: ""
    port: 443
    uuid: ""
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername: ""
    reality-opts:
      public-key: ""
      short-id: ""
    client-fingerprint: chrome

FilterHK: &FilterHK "^(?=.*(é¦™æ¸¯|HK|Hong|ğŸ‡­ğŸ‡°))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterJP: &FilterJP "^(?=.*(æ—¥æœ¬|JP|Japan|ğŸ‡¯ğŸ‡µ))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterKR: &FilterKR "^(?=.*(éŸ©å›½|éŸ“|KR|Korea|ğŸ‡°ğŸ‡·))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterSG: &FilterSG "^(?=.*(æ–°åŠ å¡|ç‹®åŸ|SG|Singapore|ğŸ‡¸ğŸ‡¬))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterUS: &FilterUS "^(?=.*(ç¾å›½|US|United States|America|ğŸ‡ºğŸ‡¸))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterUK: &FilterUK "^(?=.*(è‹±å›½|UK|United Kingdom|ğŸ‡¬ğŸ‡§))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterFR: &FilterFR "^(?=.*(æ³•å›½|FR|France|ğŸ‡«ğŸ‡·))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterDE: &FilterDE "^(?=.*(å¾·å›½|DE|Germany|ğŸ‡©ğŸ‡ª))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterTW: &FilterTW "^(?=.*(å°æ¹¾|TW|Taiwan|Wan|ğŸ‡¹ğŸ‡¼))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterAll: &FilterAll '^(?=.*(.))(?!(.*((?i)æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…|(\b(TOTAL|EXPIRE|EMAIL|Panel|Channel|Author)\b|(\d{4}-\d{2}-\d{2}|\d+G))))).*$'

AutoProviders: &AutoProviders
  type: url-test
  url: "https://www.gstatic.com/generate_204"
  interval: 60
  tolerance: 200
  lazy: true
  include-all-providers: true
SelectProviders: &SelectProviders
  type: select
  include-all: true
SelectProxies: &SelectProxies
  type: select
  include-all-proxies: true

# ä»£ç†ç»„
proxy-groups:
  - name: HK-è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterHK
  - name: US-è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterUS
  - name: JP-è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterJP
  - name: SG-è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterSG
  - name: AI
    <<: *SelectProxies
    proxies:
      - DIRECT
      - HK-è‡ªåŠ¨é€‰æ‹©
      - US-è‡ªåŠ¨é€‰æ‹©
      - JP-è‡ªåŠ¨é€‰æ‹©
      - SG-è‡ªåŠ¨é€‰æ‹©
  - name: æµ‹é€Ÿ
    <<: *SelectProxies
    proxies:
      - DIRECT
      - HK-è‡ªåŠ¨é€‰æ‹©
      - US-è‡ªåŠ¨é€‰æ‹©
      - JP-è‡ªåŠ¨é€‰æ‹©
      - SG-è‡ªåŠ¨é€‰æ‹©
  - name: æµåª’ä½“
    <<: *SelectProxies
    proxies:
      - DIRECT
      - HK-è‡ªåŠ¨é€‰æ‹©
      - US-è‡ªåŠ¨é€‰æ‹©
      - JP-è‡ªåŠ¨é€‰æ‹©
      - SG-è‡ªåŠ¨é€‰æ‹©
  - name: PROXY
    <<: *SelectProxies
    proxies:
      - DIRECT
      - HK-è‡ªåŠ¨é€‰æ‹©
      - US-è‡ªåŠ¨é€‰æ‹©
      - JP-è‡ªåŠ¨é€‰æ‹©
      - SG-è‡ªåŠ¨é€‰æ‹©

# è®¢é˜…é…ç½®
NodeParam: &NodeParam
  type: http
  interval: 86400
  proxy: DIRECT
  size-limit: 0
  header:
    User-Agent:
      - "mihomo/1.19.0"
      - "Clash/v1.18.0"
  health-check:
    enable: true
    interval: 600
    lazy: true
    url: https://www.gstatic.com/generate_204
  override:
    skip-cert-verify: true
    udp: true
# è®¢é˜…
proxy-providers:
  provider1:
    url: ""
    <<: *NodeParam

# è§„åˆ™è®¢é˜…
RuleSet_classical_text: &RuleSet_classical_text
  behavior: classical
  format: text
  type: http
  interval: 86400
RuleSet_domain_text: &RuleSet_domain_text
  behavior: domain
  format: text
  type: http
  interval: 86400
RuleSet_ipcidr_text: &RuleSet_ipcidr_text
  behavior: ipcidr
  format: text
  type: http
  interval: 86400
RuleSet_classical_yaml: &RuleSet_classical_yaml
  behavior: classical
  format: yaml
  type: http
  interval: 86400
RuleSet_domain_yaml: &RuleSet_domain_yaml
  behavior: domain
  format: yaml
  type: http
  interval: 86400
RuleSet_ipcidr_yaml: &RuleSet_ipcidr_yaml
  behavior: ipcidr
  format: yaml
  type: http
  interval: 86400
rule-providers:
  ## https://github.com/SukkaW/Surge/
  Speedtest:
    <<: *RuleSet_domain_text
    url: https://ruleset.skk.moe/Clash/domainset/speedtest.txt
  Ai:
    <<: *RuleSet_classical_text
    url: https://ruleset.skk.moe/Clash/non_ip/ai.txt
  MicrosoftCdn:
    <<: *RuleSet_classical_text
    url: https://ruleset.skk.moe/Clash/non_ip/microsoft_cdn.txt

  ## https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Clash
  Download:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Download/Download_No_Resolve.yaml
  Game:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Game/Game_No_Resolve.yaml
  TikTok:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/TikTok/TikTok_No_Resolve.yaml
  XiaoMi:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/XiaoMi/XiaoMi_No_Resolve.yaml
  OPPO:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OPPO/OPPO_No_Resolve.yaml
  OnePlus:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OnePlus/OnePlus_No_Resolve.yaml
  Vivo:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Vivo/Vivo_No_Resolve.yaml
  Tencent:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Tencent/Tencent_No_Resolve.yaml
  WeChat:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/WeChat/WeChat_No_Resolve.yaml
  Weibo:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Weibo/Weibo_No_Resolve.yaml
  ChinaMedia:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMedia/ChinaMedia_No_Resolve.yaml
  GlobalMedia:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GlobalMedia/GlobalMedia_Classical_No_Resolve.yaml
  Google:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Google/Google_No_Resolve.yaml
  GoogleFCM:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GoogleFCM/GoogleFCM_No_Resolve.yaml
  Global:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Global/Global_Classical_No_Resolve.yaml
  ProxyLite:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ProxyLite/ProxyLite_No_Resolve.yaml
  GitHub:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GitHub/GitHub_No_Resolve.yaml
  Bing:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Bing/Bing_No_Resolve.yaml
  Microsoft:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft_No_Resolve.yaml

  ## è‡ªå®šä¹‰è§„åˆ™
  CustomDirect:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/alienven/clash-rules@main/DIRECT/DIRECT_No_Resolve.yaml
  CustomProxy:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/alienven/clash-rules@main/PROXY/PROXY_No_Resolve.yaml

rules:
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT
  - RULE-SET,CustomDirect,DIRECT
  - RULE-SET,CustomProxy,PROXY

  - GEOSITE,private,DIRECT
  - GEOIP,private,DIRECT,no-resolve

  - GEOSITE,category-ntp-cn,DIRECT
  - RULE-SET,Download,DIRECT
  - GEOSITE,jsdelivr,DIRECT
  - GEOSITE,tracker,DIRECT
  - RULE-SET,XiaoMi,DIRECT
  - RULE-SET,OPPO,DIRECT
  - RULE-SET,OnePlus,DIRECT
  - RULE-SET,Vivo,DIRECT
  - RULE-SET,Tencent,DIRECT
  - RULE-SET,WeChat,DIRECT
  - RULE-SET,Weibo,DIRECT
  - GEOSITE,category-ai-cn,DIRECT
  - GEOSITE,category-netdisk-cn,DIRECT
  - RULE-SET,ChinaMedia,DIRECT

  - GEOSITE,category-container,PROXY
  - RULE-SET,GitHub,PROXY
  - GEOSITE,telegram,PROXY
  - GEOIP,telegram,PROXY,no-resolve

  - RULE-SET,Bing,DIRECT
  - GEOSITE,onedrive,DIRECT
  - GEOSITE,microsoft@cn,DIRECT
  - RULE-SET,Microsoft,PROXY

  - GEOSITE,google@cn,DIRECT
  - RULE-SET,GoogleFCM,PROXY
  - RULE-SET,Google,PROXY
  - GEOSITE,youtube,æµåª’ä½“
  - GEOSITE,twitter,PROXY
  - GEOSITE,pixiv,PROXY
  - GEOSITE,apple@cn,DIRECT
  - RULE-SET,GlobalMedia,æµåª’ä½“

  - RULE-SET,Ai,AI
  - RULE-SET,Speedtest,æµ‹é€Ÿ
  - RULE-SET,TikTok,PROXY

  - GEOSITE,tld-cn,DIRECT
  - GEOSITE,steam@cn,DIRECT
  - GEOSITE,category-games@cn,DIRECT
  - GEOSITE,category-games,æ¸¸æˆå¹³å°
  - RULE-SET,Game,æ¸¸æˆå¹³å°

  - GEOSITE,cn,DIRECT
  - GEOIP,cn,DIRECT,no-resolve

  - GEOSITE,category-porn,PROXY
  - RULE-SET,Global,PROXY
  - NETWORK,udp,DIRECT

  - MATCH,PROXY
