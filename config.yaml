mixed-port: 7890 # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£
allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®š IP åœ°å€ï¼Œä»…ä½œç”¨äº allow-lan ä¸º trueï¼Œ"*"è¡¨ç¤ºæ‰€æœ‰åœ°å€
mode: rule
ipv6: true
log-level: warning # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug
unified-delay: true # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿæ—¶ï¼Œä¼šè®¡ç®— RTTï¼Œä»¥æ¶ˆé™¤è¿æ¥æ¡æ‰‹ç­‰å¸¦æ¥çš„ä¸åŒç±»å‹èŠ‚ç‚¹çš„å»¶è¿Ÿå·®å¼‚
tcp-concurrent: true # TCP å¹¶å‘è¿æ¥æ‰€æœ‰ IP, å°†ä½¿ç”¨æœ€å¿«æ¡æ‰‹çš„ TCP
#  - always, å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
#  - strict, é»˜è®¤ï¼Œç”± mihomo åˆ¤æ–­æ˜¯å¦å¼€å¯
#  - off, ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: strict
profile:
  store-selected: true # å­˜å‚¨ select é€‰æ‹©è®°å½•
  store-fake-ip: true # æŒä¹…åŒ– fake-ip
global-client-fingerprint: chrome # chrome,firefox,safari,ios,random,none options.
global-ua: clash.meta
#  TCP keep alive interval
# disable-keep-alive: false #ç›®å‰åœ¨androidç«¯å¼ºåˆ¶ä¸ºtrue
# keep-alive-idle: 15
# keep-alive-interval: 15
#è‡ªå®šä¹‰ geodata url
geox-url:
  geoip: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat
  geosite: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat
  mmdb: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb
  asn: https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb
geodata-loader: standard #standardï¼šæ ‡å‡†åŠ è½½å™¨ memconservativeï¼šä¸“ä¸ºå†…å­˜å—é™ (å°å†…å­˜) è®¾å¤‡ä¼˜åŒ–çš„åŠ è½½å™¨ (é»˜è®¤å€¼)
geo-auto-update: true # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 72 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

# Tun é…ç½®
tun:
  enable: true
  stack: system # gvisor/mixed
  dns-hijack:
    - any:53

# å—…æ¢åŸŸå å¯é€‰é…ç½®redir-hostæ¨¡å¼å¼€å¯
sniffer:
  enable: false
  force-dns-mapping: true ## å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  parse-pure-ip: true ## å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  override-destination: true ## æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ true
  sniff:
    # TLS å’Œ QUIC é»˜è®¤å¦‚æœä¸é…ç½® ports é»˜è®¤å—…æ¢ 443
    QUIC:
    TLS:
    HTTP:
      # é»˜è®¤å—…æ¢ 80
      # force-domain:
      #   - "+.v2ex.com"
  # skip-src-address: # å¯¹äºæ¥æºipè·³è¿‡å—…æ¢
  #   - 192.168.0.0/16
  skip-dst-address:
    # å¯¹äºç›®æ ‡ipè·³è¿‡å—…æ¢
    - 192.168.0.0/16
  ## å¯¹å—…æ¢ç»“æœè¿›è¡Œè·³è¿‡
  skip-domain:
    - "Mijia Cloud"
    - "dlg.io.mi.com"

# èŠ‚ç‚¹
proxies:
  - name: US-Reality
    type: vless
    server:
    port: 443
    uuid:
    network: tcp
    tls: true
    udp: true
    flow: xtls-rprx-vision
    servername:
    reality-opts:
      public-key:
      short-id:
    client-fingerprint: chrome

FilterHK: &FilterHK "^(?=.*(é¦™æ¸¯|HK|Hong|ğŸ‡­ğŸ‡°))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterJP: &FilterJP "^(?=.*(æ—¥æœ¬|JP|Japan|ğŸ‡¯ğŸ‡µ))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterKR: &FilterKR "^(?=.*(éŸ©å›½|éŸ“|KR|Korea|ğŸ‡°ğŸ‡·))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterSG: &FilterSG "^(?=.*(æ–°åŠ å¡|ç‹®åŸ|SG|Singapore|ğŸ‡¸ğŸ‡¬))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterUS: &FilterUS "^(?=.*(ç¾å›½|US|United States|America|ğŸ‡ºğŸ‡¸))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterUK: &FilterUK "^(?=.*(è‹±å›½|UK|United Kingdom|ğŸ‡¬ğŸ‡§))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterFR: &FilterFR "^(?=.*(æ³•å›½|FR|France|ğŸ‡«ğŸ‡·))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterDE: &FilterDE "^(?=.*(å¾·å›½|DE|Germany|ğŸ‡©ğŸ‡ª))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterTW: &FilterTW "^(?=.*(å°æ¹¾|TW|Taiwan|Wan|ğŸ‡¹ğŸ‡¼))(?!(.*(Reality|æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…))).*$"
FilterAll: &FilterAll "^(?=.*(.))(?!(.*((?i)æœºåœº|æ¯æœˆ|å‰©ä½™|è®¢é˜…|(\b(TOTAL|EXPIRE|EMAIL|Panel|Channel|Author)\b|(\d{4}-\d{2}-\d{2}|\d+G))))).*$"

AutoProviders: &AutoProviders
  type: url-test
  url: https://www.gstatic.com/generate_204
  tolerance: 100
  lazy: true
  include-all-providers: true
SelectProviders: &SelectProviders
  type: select
  include-all: true
SelectProxies: &SelectProxies
  type: select
  include-all-proxies: true

# ä»£ç†ç»„
proxy-groups:
  - name: ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterHK
  - name: ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterUS
  - name: ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterJP
  - name: ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
    <<: *AutoProviders
    filter: *FilterSG
  - name: ğŸ¤–AI
    <<: *SelectProxies
    proxies:
      - DIRECT
      - ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©
  - name: ğŸ“ˆæµ‹é€Ÿ
    <<: *SelectProxies
    proxies:
      - DIRECT
      - ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©
  - name: ğŸ®æ¸¸æˆ
    <<: *SelectProxies
    proxies:
      - DIRECT
      - ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©
  - name: ğŸ¬æµåª’ä½“
    <<: *SelectProxies
    proxies:
      - DIRECT
      - ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©
  - name: ğŸ¯ä»£ç†
    <<: *SelectProxies
    proxies:
      - DIRECT
      - ğŸ‡­ğŸ‡°è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¯ğŸ‡µè‡ªåŠ¨é€‰æ‹©
      - ğŸ‡¸ğŸ‡¬è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡ºğŸ‡¸è‡ªåŠ¨é€‰æ‹©

# è®¢é˜…é…ç½®
NodeParam: &NodeParam
  type: http
  interval: 86400
  proxy: DIRECT
  header:
    User-Agent:
      - "mihomo/1.19.0"
      - "Clash/v1.18.0"
  health-check:
    enable: true
    lazy: true
    url: https://www.gstatic.com/generate_204
  override:
    skip-cert-verify: true
    udp: true
# è®¢é˜…
proxy-providers:
  provider1:
    url:
    <<: *NodeParam

# è§„åˆ™è®¢é˜…
RuleSet_classical_text: &RuleSet_classical_text
  behavior: classical
  format: text
  type: http
  interval: 86400
RuleSet_domain_text: &RuleSet_domain_text
  behavior: domain
  format: text
  type: http
  interval: 86400
RuleSet_ipcidr_text: &RuleSet_ipcidr_text
  behavior: ipcidr
  format: text
  type: http
  interval: 86400
RuleSet_classical_yaml: &RuleSet_classical_yaml
  behavior: classical
  format: yaml
  type: http
  interval: 86400
RuleSet_domain_yaml: &RuleSet_domain_yaml
  behavior: domain
  format: yaml
  type: http
  interval: 86400
RuleSet_ipcidr_yaml: &RuleSet_ipcidr_yaml
  behavior: ipcidr
  format: yaml
  type: http
  interval: 86400
rule-providers:
  ## https://github.com/SukkaW/Surge/
  Speedtest:
    <<: *RuleSet_domain_text
    url: https://ruleset.skk.moe/Clash/domainset/speedtest.txt
  ## https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Clash
  GlobalMedia:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GlobalMedia/GlobalMedia_Classical_No_Resolve.yaml
  Global:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Global/Global_Classical_No_Resolve.yaml
  ## è‡ªå®šä¹‰è§„åˆ™
  CustomDirect:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/alienven/clash-rules@main/DIRECT/DIRECT_No_Resolve.yaml
  CustomProxy:
    <<: *RuleSet_classical_yaml
    url: https://cdn.jsdelivr.net/gh/alienven/clash-rules@main/PROXY/PROXY_No_Resolve.yaml

rules:
  - GEOSITE,private,DIRECT
  - GEOIP,private,DIRECT,no-resolve
  - AND,((NETWORK,UDP),(DST-PORT,443)),REJECT
  - GEOSITE,category-httpdns-cn@ads,REJECT
  - RULE-SET,CustomDirect,DIRECT
  - RULE-SET,CustomProxy,ğŸ¯ä»£ç†
  - GEOSITE,category-ntp-cn,DIRECT
  - GEOSITE,alibaba,DIRECT
  - GEOSITE,tencent,DIRECT
  - GEOSITE,jsdelivr,DIRECT
  - GEOSITE,tracker,DIRECT
  - GEOSITE,category-ai-!cn,ğŸ¤–AI
  - GEOSITE,category-container,ğŸ¯ä»£ç†
  - GEOSITE,category-dev,ğŸ¯ä»£ç†
  - GEOSITE,cloudflare,ğŸ¯ä»£ç†
  - GEOIP,cloudflare,ğŸ¯ä»£ç†,no-resolve
  - RULE-SET,Speedtest,ğŸ“ˆæµ‹é€Ÿ
  - GEOSITE,apple@cn,DIRECT
  - GEOSITE,github,ğŸ¯ä»£ç†
  - GEOSITE,microsoft@cn,DIRECT
  - GEOSITE,microsoft,ğŸ¯ä»£ç†
  - GEOSITE,telegram,ğŸ¯ä»£ç†
  - GEOIP,telegram,ğŸ¯ä»£ç†,no-resolve
  - GEOSITE,category-porn,ğŸ¬æµåª’ä½“
  - RULE-SET,GlobalMedia,ğŸ¬æµåª’ä½“
  - GEOSITE,google@cn,DIRECT
  - GEOSITE,google,ğŸ¯ä»£ç†
  - GEOIP,google,ğŸ¯ä»£ç†,no-resolve
  - GEOSITE,category-game-accelerator-cn,DIRECT
  - GEOSITE,tld-cn,DIRECT
  - GEOSITE,category-games@cn,DIRECT
  - GEOSITE,category-games,ğŸ®æ¸¸æˆ
  - GEOSITE,cn,DIRECT
  - GEOIP,cn,DIRECT,no-resolve
  - MATCH,ğŸ¯ä»£ç†

#hosts:
# "*.mihomo.dev": 127.0.0.1
# ".dev": 127.0.0.1
# "alpha.mihomo.dev": "::1"
# test.com: [1.1.1.1, 2.2.2.2]
# home.lan: lan # lan ä¸ºç‰¹åˆ«å­—æ®µï¼Œå°†åŠ å…¥æœ¬åœ°æ‰€æœ‰ç½‘å¡çš„åœ°å€
# baidu.com: google.com # åªå…è®¸é…ç½®ä¸€ä¸ªåˆ«å

# DNS é…ç½®
dns:
  enable: true
  prefer-h3: false
  ipv6: true
  enhanced-mode: fake-ip # fake-ip or redir-host
  fake-ip-range: 198.18.0.1/16 # fake-ip æ± è®¾ç½®
  # é…ç½®fake-ip-filterçš„åŒ¹é…æ¨¡å¼ï¼Œé»˜è®¤ä¸ºblacklistï¼Œå³å¦‚æœåŒ¹é…æˆåŠŸä¸è¿”å›fake-ip
  # å¯è®¾ç½®ä¸ºwhitelistï¼Œå³åªæœ‰åŒ¹é…æˆåŠŸæ‰è¿”å›fake-ip
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - "*"
    - "*.lan"
    - "+.local"
    - "time.*.com"
    - "ntp.*.com"
    - rule-set:CustomDirect
    - geosite:private
    - geosite:category-ntp
    - geosite:tracker
    - geosite:tld-cn
    - geosite:cn
    # fakeip-filter ä¸º rule-providers ä¸­çš„åä¸º fakeip-filter è§„åˆ™è®¢é˜…ï¼Œ
    # ä¸” behavior å¿…é¡»ä¸º domain/classicalï¼Œå½“ä¸º classical æ—¶ä»…ä¼šç”Ÿæ•ˆåŸŸåç±»è§„åˆ™
  # use-hosts: true # æŸ¥è¯¢ hosts
  # é…ç½®åé¢çš„nameserverã€fallbackå’Œnameserver-policyå‘dnsæœåŠ¡å™¨çš„è¿æ¥è¿‡ç¨‹æ˜¯å¦éµå®ˆéµå®ˆrulesè§„åˆ™
  # å¦‚æœä¸ºfalseï¼ˆé»˜è®¤å€¼ï¼‰åˆ™è¿™ä¸‰éƒ¨åˆ†çš„dnsæœåŠ¡å™¨åœ¨æœªç‰¹åˆ«æŒ‡å®šçš„æƒ…å†µä¸‹ä¼šç›´è¿
  # å¦‚æœä¸ºtrueï¼Œå°†ä¼šæŒ‰ç…§rulesçš„è§„åˆ™åŒ¹é…é“¾æ¥æ–¹å¼ï¼ˆèµ°ä»£ç†æˆ–ç›´è¿ï¼‰ï¼Œå¦‚æœæœ‰ç‰¹åˆ«æŒ‡å®šåˆ™ä»»ç„¶ä»¥æŒ‡å®šå€¼ä¸ºå‡†
  # ä»…å½“proxy-server-nameserveréç©ºæ—¶å¯ä»¥å¼€å¯æ­¤é€‰é¡¹, å¼ºçƒˆä¸å»ºè®®å’Œprefer-h3ä¸€èµ·ä½¿ç”¨
  # æ­¤å¤–ï¼Œè¿™ä¸‰è€…é…ç½®ä¸­çš„dnsæœåŠ¡å™¨å¦‚æœå‡ºç°åŸŸåä¼šé‡‡ç”¨default-nameserveré…ç½®é¡¹è§£æï¼Œä¹Ÿè¯·ç¡®ä¿æ­£ç¡®é…ç½®default-nameserver
  respect-rules: false
  # ç”¨äºè§£æ DNS æœåŠ¡å™¨ çš„åŸŸåå¿…é¡»ä¸º IP
  default-nameserver:
    - 127.0.0.1:6053
  # é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨
  nameserver:
    - 127.0.0.1:6053
